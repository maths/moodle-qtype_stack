define("qtype_stack/edityaml",["exports","qtype_stack/js-yaml-lazy"],(function(_exports,yaml){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.setup=void 0,yaml=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}
/**
   * A javascript module to allow editing of PRTs in YAML format.
   *
   * @module     qtype_stack/edityaml
   * @copyright  2025 The University of Edinburgh
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */(yaml);function changeCallback(){var _document$querySelect3;const saveDiv=document.querySelector("#fgroup_id_error_yamlbuttons");saveDiv&&(saveDiv.style.display="block",saveDiv.innerHTML=getTranslation("yamlwarning")),null===(_document$querySelect3=document.querySelector("#id_yamlinput"))||void 0===_document$querySelect3||_document$querySelect3.removeEventListener("input",changeCallback)}function yamlRevert(){const inputElement=document.querySelector("#id_yamlinput");if(!inputElement)return;let yamltext;try{yamltext=yamlParse()}catch(e){yamltext=""}inputElement.value=yamltext,function(){var _document$querySelect4;const saveDiv=document.querySelector("#fgroup_id_error_yamlbuttons");saveDiv&&(saveDiv.style.display="none",saveDiv.innerHTML="");const errorDiv=document.querySelector("#id_error_yamlinput");errorDiv&&(errorDiv.style.display="none",errorDiv.innerHTML=""),null===(_document$querySelect4=document.querySelector("#id_yamlinput"))||void 0===_document$querySelect4||_document$querySelect4.addEventListener("input",changeCallback)}()}function yamlParse(){var _document$querySelect5;const prtsArray=[],json=null===(_document$querySelect5=document.querySelector('input[name="stack-yamloriginal"]'))||void 0===_document$querySelect5?void 0:_document$querySelect5.value;if(!json)return"";let prtsObject;try{prtsObject=JSON.parse(json)}catch(e){return""}Object.values(prtsObject).forEach((prt=>{delete prt.id,delete prt.questionid,delete prt.firstnodename,prt.nodes&&(prt.node=[],prt.nodes.forEach((node=>{node.name=node.nodename,delete node.nodename,delete node.id,delete node.questionid,delete node.prtname;const{name:name,...rest}=node,newnode={name:name,...rest};prt.node.push(newnode)})),delete prt.nodes),prtsArray.push(prt)}));try{return yaml.dump(prtsArray,{lineWidth:-1})}catch(e){return""}}function getTranslation(key){var _json$key;const transElement=document.querySelector('input[name="stack-yamltranslations"]');if(!transElement)return"";let json=transElement.value;if(!json)return"";try{json=JSON.parse(json)}catch(e){return""}return null!==(_json$key=json[key])&&void 0!==_json$key?_json$key:""}function yamlConvert(){var _document$querySelect6;const yamltext=null===(_document$querySelect6=document.querySelector("#id_yamlinput"))||void 0===_document$querySelect6?void 0:_document$querySelect6.value,errorDiv=document.querySelector("#id_error_yamlinput");if(!errorDiv)return;errorDiv.innerHTML="",errorDiv.style.display="none";let prtsArray,isError=!1;try{prtsArray=yaml.load(yamltext)}catch(e){return errorDiv.innerHTML+=getTranslation("yamlerror")+": "+e.message+"<br>",void(errorDiv.style.display="block")}for(const currentPrt of prtsArray){const prtkey=currentPrt.name;if(document.querySelector("#id_"+prtkey+"prtheader")){if(currentPrt.node)for(const currentNode of currentPrt.node){const nodeKey=currentNode.name;document.querySelector("#id_"+prtkey+"description_"+nodeKey)||(errorDiv.innerHTML+=getTranslation("yamlnodewarning")+" "+prtkey+" - "+nodeKey+"<br>",errorDiv.style.display="block",isError=!0)}}else errorDiv.innerHTML+=getTranslation("yamlprtwarning")+" "+prtkey+"<br>",errorDiv.style.display="block",isError=!0}if(!isError)for(const currentPrt of prtsArray){var _ref;const prtkey=currentPrt.name;if((null!==(_ref="value"in currentPrt)&&void 0!==_ref?_ref:document.querySelector("#id_"+prtkey+"value"))&&(document.querySelector("#id_"+prtkey+"value").value=currentPrt.value),"autosimplify"in currentPrt&&document.querySelector("#id_"+prtkey+"autosimplify")&&(document.querySelector("#id_"+prtkey+"autosimplify").value=currentPrt.autosimplify),"feedbackstyle"in currentPrt&&document.querySelector("#id_"+prtkey+"feedbackstyle")&&(document.querySelector("#id_"+prtkey+"feedbackstyle").value=currentPrt.feedbackstyle),"feedbackvariables"in currentPrt&&document.querySelector("#id_"+prtkey+"feedbackvariables")&&(document.querySelector("#id_"+prtkey+"feedbackvariables").value=currentPrt.feedbackvariables),currentPrt.node)for(const currentNode of currentPrt.node){const nodeKey=currentNode.name;"description"in currentNode&&document.querySelector("#id_"+prtkey+"description_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"description_"+nodeKey).value=currentNode.description),"answertest"in currentNode&&document.querySelector("#id_"+prtkey+"answertest_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"answertest_"+nodeKey).value=currentNode.answertest),"sans"in currentNode&&document.querySelector("#id_"+prtkey+"sans_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"sans_"+nodeKey).value=currentNode.sans),"tans"in currentNode&&document.querySelector("#id_"+prtkey+"tans_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"tans_"+nodeKey).value=currentNode.tans),"testoptions"in currentNode&&document.querySelector("#id_"+prtkey+"testoptions_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"testoptions_"+nodeKey).value=currentNode.testoptions),"quiet"in currentNode&&document.querySelector("#id_"+prtkey+"quiet_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"quiet_"+nodeKey).value=currentNode.quiet),"truescoremode"in currentNode&&document.querySelector("#id_"+prtkey+"truescoremode_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"truescoremode_"+nodeKey).value=currentNode.truescoremode),"truescore"in currentNode&&document.querySelector("#id_"+prtkey+"truescore_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"truescore_"+nodeKey).value=currentNode.truescore),"truepenalty"in currentNode&&document.querySelector("#id_"+prtkey+"truepenalty_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"truepenalty_"+nodeKey).value=currentNode.truepenalty),"truenextnode"in currentNode&&document.querySelector("#id_"+prtkey+"truenextnode_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"truenextnode_"+nodeKey).value=currentNode.truenextnode),"trueanswernote"in currentNode&&document.querySelector("#id_"+prtkey+"trueanswernote_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"trueanswernote_"+nodeKey).value=currentNode.trueanswernote),"truefeedback"in currentNode&&(document.querySelector("#id_"+prtkey+"truefeedback_"+nodeKey+"editable")?document.querySelector("#id_"+prtkey+"truefeedback_"+nodeKey+"editable").value=currentNode.truefeedback:document.querySelector("#id_"+prtkey+"truefeedback_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"truefeedback_"+nodeKey).value=currentNode.truefeedback)),"truefeedbackformat"in currentNode&&document.querySelector("#id_"+prtkey+"truefeedbackformat_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"truefeedbackformat_"+nodeKey).value=currentNode.truefeedbackformat),"falsescoremode"in currentNode&&document.querySelector("#id_"+prtkey+"falsescoremode_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"falsescoremode_"+nodeKey).value=currentNode.falsescoremode),"falsescore"in currentNode&&document.querySelector("#id_"+prtkey+"falsescore_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"falsescore_"+nodeKey).value=currentNode.falsescore),"falsepenalty"in currentNode&&document.querySelector("#id_"+prtkey+"falsepenalty_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"falsepenalty_"+nodeKey).value=currentNode.falsepenalty),"falsenextnode"in currentNode&&document.querySelector("#id_"+prtkey+"falsenextnode_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"falsenextnode_"+nodeKey).value=currentNode.falsenextnode),"falseanswernote"in currentNode&&document.querySelector("#id_"+prtkey+"falseanswernote_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"falseanswernote_"+nodeKey).value=currentNode.falseanswernote),"falsefeedback"in currentNode&&(document.querySelector("#id_"+prtkey+"falsefeedback_"+nodeKey+"editable")?document.querySelector("#id_"+prtkey+"falsefeedback_"+nodeKey+"editable").value=currentNode.falsefeedback:document.querySelector("#id_"+prtkey+"falsefeedback_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"falsefeedback_"+nodeKey).value=currentNode.falsefeedback)),"falsefeedbackformat"in currentNode&&document.querySelector("#id_"+prtkey+"falsefeedbackformat_"+nodeKey)&&(document.querySelector("#id_"+prtkey+"falsefeedbackformat_"+nodeKey).value=currentNode.falsefeedbackformat)}}}_exports.setup=()=>{var _document$querySelect,_document$querySelect2;const inputElement=document.querySelector("#id_yamlinput");inputElement&&(inputElement.value?inputElement.value!=yamlParse()?changeCallback():inputElement.addEventListener("input",changeCallback):yamlRevert(),null===(_document$querySelect=document.querySelector("#id_stack-revert-yaml"))||void 0===_document$querySelect||_document$querySelect.addEventListener("click",yamlRevert),null===(_document$querySelect2=document.querySelector("#id_stack-convert-yaml"))||void 0===_document$querySelect2||_document$querySelect2.addEventListener("click",yamlConvert))}}));

//# sourceMappingURL=edityaml.min.js.map