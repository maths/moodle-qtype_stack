define("qtype_stack/metadata/metadata",["exports","core/reactive","qtype_stack/metadata/mutations","qtype_stack/metadata/events"],(function(_exports,_reactive,_mutations,_events){function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.metadata=void 0;class StackMetadata extends _reactive.Reactive{constructor(){super(...arguments),_defineProperty(this,"lib",{languages:["en"],defaultLanguage:"en",user:{firstname:"",lastname:"",institution:""},licenses:[{value:"unknown",text:"unknown"}],defaultlicense:"unknown",placeholder:""}),_defineProperty(this,"container",null)}loadState(){let metadata=document.querySelector('input[name="metadata"]');try{this.lib=JSON.parse(metadata.dataset.lib),this.lib.user.year=(new Date).getFullYear();let languages=new Set(this.lib.languages);this.lib.languages=languages.difference(new Set([null,void 0,""])),this.lib.languages=Array.from(this.lib.languages)}catch(e){}try{var _metadata;metadata=this.jsonToState(null===(_metadata=metadata)||void 0===_metadata?void 0:_metadata.value)}catch(e){metadata={}}metadata.metadataTicker={value:1},this.setInitialState(metadata)}replacer(key,value){const languages=[];switch(key){case"metadataTicker":case"id":return;case"language":for(const lang of value)languages.push(lang.value);return languages;case"license":case"isPartOf":return value.value;default:return value}}reviver(key,value){const holder=[];let id=1;switch(key){case"contributor":case"additional":for(const current of value)current.id=id,holder.push(current),id++;return holder;case"language":for(const lang of value)holder.push({id:id,value:lang}),id++;return holder;case"license":case"isPartOf":return{value:value};default:return value}}jsonToState(data){data=JSON.parse(data,this.reviver);const contribFields=["id","firstName","lastName","institution","year"],additionalFields=["id","scope","property","qualifier","value"],standardFields=["id","value"];(data=this.stripFields(data,["creator","contributor","language","license","isPartOf","additional"])).creator=this.tidyObject(data.creator,["firstName","lastName","institution","year"]),data.contributor=Array.isArray(data.contributor)?data.contributor:[];const contribHolder=[];for(let contrib of data.contributor)contrib=this.tidyObject(contrib,contribFields),contribHolder.push(contrib);data.contributor=contribHolder,data.language=Array.isArray(data.language)?data.language:[];const langHolder=[];for(let lang of data.language)lang=this.tidyObject(lang,standardFields),langHolder.push(lang);data.language=langHolder,data.isPartOf=this.tidyObject(data.isPartOf,standardFields),data.license=this.tidyObject(data.license,standardFields),data.additional=Array.isArray(data.additional)?data.additional:[];const addHolder=[];for(let addInfo of data.additional)addInfo=this.tidyObject(addInfo,additionalFields),addHolder.push(addInfo);return data.additional=addHolder,data}stripFields(obj,fields){const result={};for(const suppliedField in obj)fields.includes(suppliedField)&&(result[suppliedField]=obj[suppliedField]);return result}addFields(obj,fields){for(const field of fields)Object.hasOwn(obj,field)?obj[field]=String(obj[field]):obj[field]="";return obj}tidyObject(obj,fields){return obj=obj&&"object"==typeof obj?obj:{},obj=this.stripFields(obj,fields),obj=this.addFields(obj,fields)}}const metadata=new StackMetadata({name:"qtype_stack_metadata",eventName:_events.eventTypes.qtypeStackStateUpdated,eventDispatch:_events.notifyQtypeStackStateUpdated,mutations:_mutations.mutations});_exports.metadata=metadata}));

//# sourceMappingURL=metadata.min.js.map