define("qtype_stack/metadata/metadata",["exports","core/reactive","qtype_stack/metadata/mutations","qtype_stack/metadata/events"],(function(_exports,_reactive,_mutations,_events){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.metadata=void 0;class StackMetadata extends _reactive.Reactive{constructor(){var obj,key,value;super(...arguments),value={languages:["en"],defaultLanguage:"en",user:{firstname:"",lastname:"",institution:""},licenses:[{value:"unknown",text:"unknown"}],defaultlicense:"unknown"},(key="lib")in(obj=this)?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value}loadState(){var _metadata;let metadata=document.querySelector('input[name="metadata"]');this.lib=JSON.parse(metadata.dataset.lib),this.lib.user.year=(new Date).getFullYear();let languages=new Set(this.lib.languages);this.lib.languages=languages.difference(new Set([null,void 0,""])),this.lib.languages=Array.from(this.lib.languages),metadata=this.jsonToState(null===(_metadata=metadata)||void 0===_metadata?void 0:_metadata.value),console.log(metadata),this.setInitialState(metadata)}replacer(key,value){const languages=[];switch(key){case"id":return;case"language":for(const lang of value)languages.push(lang.value);return languages;case"license":case"isPartOf":return value.value;default:return value}}reviver(key,value){const holder=[];let id=1;switch(key){case"contributor":case"additional":for(const current of value)current.id=id,holder.push(current),id++;return holder;case"language":for(const lang of value)holder.push({id:id,value:lang}),id++;return holder;case"license":case"isPartOf":return{value:value};default:return value}}jsonToState(data){data=JSON.parse(data,this.reviver);const fields=["creator","contributor","language","license","isPartOf","additional"];data=this.stripFields(data,fields);const contribFields=["id","firstName","lastName","institution","year"],additionalFields=["id","scope","property","qualifier","value"],standardFields=["id","value"];for(const field of fields)switch(field){case"creator":data.creator=this.tidyObject(data.creator,contribFields);break;case"contributor":data.contributor=Array.isArray(data.contributor)?data.contributor:[];for(let contrib in data.contributor)contrib=this.tidyObject(contrib,contribFields);break;case"language":data.language=Array.isArray(data.language)?data.language:[];for(let lang of data.language)lang=this.tidyObject(lang,standardFields);break;case"isPartOf":case"license":data[field]=this.tidyObject(data[field],standardFields);break;case"additional":data.additional=Array.isArray(data.additional)?data.additional:[];for(let addInfo in data.additional)addInfo=this.tidyObject(addInfo,additionalFields)}return data}stripFields(obj,fields){const result={};for(const suppliedField in obj)fields.includes(suppliedField)&&(result[suppliedField]=obj[suppliedField]);return result}addFields(obj,fields){for(const field in fields)Object.hasOwn(obj,field)?obj[field]=String(obj[field]):obj[field]="";return obj}tidyObject(obj,fields){return obj=obj&&"object"==typeof obj?obj:{},obj=this.stripFields(obj,fields),obj=this.addFields(obj,fields)}}const metadata=new StackMetadata({name:"qtype_stack_metadata",eventName:_events.eventTypes.qtypeStackStateUpdated,eventDispatch:_events.notifyQtypeStackStateUpdated,mutations:_mutations.mutations});_exports.metadata=metadata}));

//# sourceMappingURL=metadata.min.js.map