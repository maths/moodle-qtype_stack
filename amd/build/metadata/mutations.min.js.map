{"version":3,"file":"mutations.min.js","sources":["../../src/metadata/mutations.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Default mutation manager\n *\n * @module     qtype_stack/metadata\n * @copyright  2025 University of Edinburgh\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later.\n */\nclass Mutations {\n    updateAll(stateManager, inputArray) {\n        const state = stateManager.state;\n        stateManager.setReadOnly(false);\n        for (const field of inputArray) {\n            const parts = field[0].split('_');\n            const id = parts[1];\n            const property = parts[2];\n            const subproperty = parts[3];\n            if (id != 0) {\n                const existing = state[property].get(id);\n                if (existing) {\n                    existing[subproperty] = field[1];\n                }\n            } else {\n                state[property][subproperty] = field[1];\n            }\n        }\n        stateManager.setReadOnly(true);\n    }\n\n    deleteRow(stateManager, property, id) {\n        const state = stateManager.state;\n        stateManager.setReadOnly(false);\n        if (property === 'scope') {\n            const matchingAddInfo = [];\n            state.additional.forEach((addInfo) => {\n                if (addInfo.scope === id) {\n                    matchingAddInfo.push(addInfo.id);\n                }\n            });\n            for (const current of matchingAddInfo) {\n                state.additional.delete(current);\n            }\n        } else {\n            state[property].delete(id);\n        }\n        stateManager.setReadOnly(true);\n    }\n\n    addItem(stateManager, category, id) {\n        const state = stateManager.state;\n        let addCategory = category;\n        let newItem = null;\n        let existingProperty = null;\n        switch (category) {\n            case 'language':\n                newItem = {\n                    value: \"\"\n                };\n                break;\n            case 'contributor':\n                newItem = {\n                    firstName: \"\",\n                    lastName: \"\",\n                    institution: \"\",\n                    year: String(new Date().getFullYear())\n                };\n                break;\n            case 'scope':\n                newItem = {\n                    scope: '',\n                    property: '',\n                    qualifier: '',\n                    value: ''\n                };\n                addCategory = 'additional';\n                break;\n            case 'property':\n                existingProperty = state.additional.get(id);\n                newItem = {\n                    scope: existingProperty.scope,\n                    property: '',\n                    qualifier: '',\n                    value: ''\n                };\n                addCategory = 'additional';\n                break;\n            default:\n        }\n        const keys = Array.from(state[addCategory]);\n        if (keys.length === 0) {\n            newItem.id = 1;\n        } else {\n            keys.sort((a, b) => b[0] - a[0]);\n            newItem.id = 1 + parseInt(keys[0][0]);\n        }\n        stateManager.setReadOnly(false);\n        state[addCategory].add(newItem);\n        stateManager.setReadOnly(true);\n    }\n\n    updateFromJson(stateManager, data) {\n        const state = stateManager.state;\n        stateManager.setReadOnly(false);\n        for (const prop in data) {\n            state[prop] = data[prop];\n        }\n        stateManager.setReadOnly(true);\n    }\n}\n\nexport const mutations = new Mutations();"],"names":["mutations","updateAll","stateManager","inputArray","state","setReadOnly","field","parts","split","id","property","subproperty","existing","get","deleteRow","matchingAddInfo","additional","forEach","addInfo","scope","push","current","delete","addItem","category","addCategory","newItem","existingProperty","value","firstName","lastName","institution","year","String","Date","getFullYear","qualifier","keys","Array","from","length","sort","a","b","parseInt","add","updateFromJson","data","prop"],"mappings":"gKA4HaA,UAAY;;;;;;;;MArGrBC,UAAUC,aAAcC,kBACdC,MAAQF,aAAaE,MAC3BF,aAAaG,aAAY,OACpB,MAAMC,SAASH,WAAY,OACtBI,MAAQD,MAAM,GAAGE,MAAM,KACvBC,GAAKF,MAAM,GACXG,SAAWH,MAAM,GACjBI,YAAcJ,MAAM,MAChB,GAANE,GAAS,OACHG,SAAWR,MAAMM,UAAUG,IAAIJ,IACjCG,WACAA,SAASD,aAAeL,MAAM,SAGlCF,MAAMM,UAAUC,aAAeL,MAAM,GAG7CJ,aAAaG,aAAY,GAG7BS,UAAUZ,aAAcQ,SAAUD,UACxBL,MAAQF,aAAaE,SAC3BF,aAAaG,aAAY,GACR,UAAbK,SAAsB,OAChBK,gBAAkB,GACxBX,MAAMY,WAAWC,SAASC,UAClBA,QAAQC,QAAUV,IAClBM,gBAAgBK,KAAKF,QAAQT,WAGhC,MAAMY,WAAWN,gBAClBX,MAAMY,WAAWM,OAAOD,cAG5BjB,MAAMM,UAAUY,OAAOb,IAE3BP,aAAaG,aAAY,GAG7BkB,QAAQrB,aAAcsB,SAAUf,UACtBL,MAAQF,aAAaE,UACvBqB,YAAcD,SACdE,QAAU,KACVC,iBAAmB,YACfH,cACC,WACDE,QAAU,CACNE,MAAO,cAGV,cACDF,QAAU,CACNG,UAAW,GACXC,SAAU,GACVC,YAAa,GACbC,KAAMC,QAAO,IAAIC,MAAOC,0BAG3B,QACDT,QAAU,CACNP,MAAO,GACPT,SAAU,GACV0B,UAAW,GACXR,MAAO,IAEXH,YAAc,uBAEb,WACDE,iBAAmBvB,MAAMY,WAAWH,IAAIJ,IACxCiB,QAAU,CACNP,MAAOQ,iBAAiBR,MACxBT,SAAU,GACV0B,UAAW,GACXR,MAAO,IAEXH,YAAc,mBAIhBY,KAAOC,MAAMC,KAAKnC,MAAMqB,cACV,IAAhBY,KAAKG,OACLd,QAAQjB,GAAK,GAEb4B,KAAKI,MAAK,CAACC,EAAGC,IAAMA,EAAE,GAAKD,EAAE,KAC7BhB,QAAQjB,GAAK,EAAImC,SAASP,KAAK,GAAG,KAEtCnC,aAAaG,aAAY,GACzBD,MAAMqB,aAAaoB,IAAInB,SACvBxB,aAAaG,aAAY,GAG7ByC,eAAe5C,aAAc6C,YACnB3C,MAAQF,aAAaE,MAC3BF,aAAaG,aAAY,OACpB,MAAM2C,QAAQD,KACf3C,MAAM4C,MAAQD,KAAKC,MAEvB9C,aAAaG,aAAY"}