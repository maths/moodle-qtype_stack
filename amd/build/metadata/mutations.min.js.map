{"version":3,"file":"mutations.min.js","sources":["../../src/metadata/mutations.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Default mutation manager\n *\n * @module     qtype_stack/metadata\n * @copyright  2025 University of Edinburgh\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later.\n */\nclass Mutations {\n    updateAll(stateManager, inputArray) {\n        const state = stateManager.state;\n        stateManager.setReadOnly(false);\n        for (const field of inputArray) {\n            const parts = field[0].split('_');\n            const id = parts[1];\n            const property = parts[2];\n            const subproperty = parts[3];\n            if (id != 0) {\n                const existing = state[property].get(id);\n                if (existing) {\n                    existing[subproperty] = field[1];\n                }\n            } else {\n                state[property][subproperty] = field[1];\n            }\n        }\n        stateManager.setReadOnly(true);\n    }\n\n    deleteRow(stateManager, property, id) {\n        const state = stateManager.state;\n        stateManager.setReadOnly(false);\n        state[property].delete(id);\n        stateManager.setReadOnly(true);\n    }\n\n    addContributor(stateManager) {\n        const state = stateManager.state;\n        const keys = Array.from(state.contributor);\n        keys.sort((a, b) => b[0] - a[0]);\n\n        const newCon = {\n            id: 1 + parseInt(keys[0][0]),\n            firstName: \"\",\n            lastName: \"\",\n            institution: \"\",\n            year: 2025\n        };\n        stateManager.setReadOnly(false);\n        state.contributor.add(newCon);\n        stateManager.setReadOnly(true);\n    }\n\n    updateFromJson(stateManager, data) {\n        const state = stateManager.state;\n        stateManager.setReadOnly(false);\n        for (const prop in data) {\n            state[prop] = data[prop];\n        }\n        stateManager.setReadOnly(true);\n    }\n}\n\nexport const mutations = new Mutations();"],"names":["mutations","updateAll","stateManager","inputArray","state","setReadOnly","field","parts","split","id","property","subproperty","existing","get","deleteRow","delete","addContributor","keys","Array","from","contributor","sort","a","b","newCon","parseInt","firstName","lastName","institution","year","add","updateFromJson","data","prop"],"mappings":"gKA6EaA,UAAY;;;;;;;;MAtDrBC,UAAUC,aAAcC,kBACdC,MAAQF,aAAaE,MAC3BF,aAAaG,aAAY,OACpB,MAAMC,SAASH,WAAY,OACtBI,MAAQD,MAAM,GAAGE,MAAM,KACvBC,GAAKF,MAAM,GACXG,SAAWH,MAAM,GACjBI,YAAcJ,MAAM,MAChB,GAANE,GAAS,OACHG,SAAWR,MAAMM,UAAUG,IAAIJ,IACjCG,WACAA,SAASD,aAAeL,MAAM,SAGlCF,MAAMM,UAAUC,aAAeL,MAAM,GAG7CJ,aAAaG,aAAY,GAG7BS,UAAUZ,aAAcQ,SAAUD,UACxBL,MAAQF,aAAaE,MAC3BF,aAAaG,aAAY,GACzBD,MAAMM,UAAUK,OAAON,IACvBP,aAAaG,aAAY,GAG7BW,eAAed,oBACLE,MAAQF,aAAaE,MACrBa,KAAOC,MAAMC,KAAKf,MAAMgB,aAC9BH,KAAKI,MAAK,CAACC,EAAGC,IAAMA,EAAE,GAAKD,EAAE,WAEvBE,OAAS,CACXf,GAAI,EAAIgB,SAASR,KAAK,GAAG,IACzBS,UAAW,GACXC,SAAU,GACVC,YAAa,GACbC,KAAM,MAEV3B,aAAaG,aAAY,GACzBD,MAAMgB,YAAYU,IAAIN,QACtBtB,aAAaG,aAAY,GAG7B0B,eAAe7B,aAAc8B,YACnB5B,MAAQF,aAAaE,MAC3BF,aAAaG,aAAY,OACpB,MAAM4B,QAAQD,KACf5B,MAAM6B,MAAQD,KAAKC,MAEvB/B,aAAaG,aAAY"}