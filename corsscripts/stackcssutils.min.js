"use strict";function split_selectors(a){if(a.includes(",")){let e=[],t=!1,s=!1,l=!1,c="",r=0;for(const n of a)switch(c+=n,n){case"(":t||s||(r+=1);break;case")":t||s||(r-=1);break;case",":t||s||0!=r||(""!=(c=(c=c.substring(0,c.length-1)).trim())&&e.push(c),c=""),l=!1;break;case"\\":l=!l;break;case'"':t?l?l=!1:t=!1:(t=!s,l=!1);break;case"'":s?l?l=!1:s=!1:(s=!t,l=!1);break;default:l=!1}return""!=(c=c.trim())&&e.push(c),e}return[a.trim()]}function extract_matching_paren(e,t){let s=!1,l=!1,c=!1,r="",a=0;for(const n of e.substring(t))switch(r+=n,n){case"(":s||l||(a+=1);break;case")":if(s||l||(a-=1),0==a)return r;break;case"\\":c=!c;break;case'"':s?c?c=!1:s=!1:(s=!l,c=!1);break;case"'":l?c?c=!1:l=!1:(l=!s,c=!1);break;default:c=!1}return r}function extract_css_id(e,t){let s="";const l=e.substring(t),c=l[Symbol.iterator]();let r=c.next();for(;!r.done&&" "!==r.value;){let e=r.value;if(null!==e.match(/[a-zA-Z_\-0-9]/)||160<=e.codePointAt(0))s+=e;else{if("\\"!==e)break;s+=e,r=c.next(),null===(e=r.value).match(/[a-fA-F0-9]/)?s+=e:(s+=e,r=c.next(),null!==(e=r.value).match(/[a-fA-F0-9]/)&&(s+=e),r=c.next(),null===(e=r.value).match(/[a-fA-F0-9]/)?s+=e:(r=c.next(),s+=r.value,r=c.next(),s+=r.value,r=c.next(),s+=r.value))}r=c.next()}return s}function simplified_css_specificity(s){let l=[0,0,0],t=(s=s.replace(/\s+/g," ").trim(),!1),c=!1,r=!1,f="";for(let e=0;e<s.length;e++){var u=s[e];switch(t||c||'"'===u||"'"===u||(f+=u),u){case"\\":r=!r;break;case'"':t?r?r=!1:t=!1:(c||(f+="s"),t=!c,r=!1);break;case"'":c?r?r=!1:c=!1:(t||(f+="s"),c=!t,r=!1);break;default:r=!1}}let a=(s=f).match(/\:\:[a-zA-Z\-]+/g);for(;null!==a&&0<a.length;){l[2]=l[2]+1;var e=a[0];"("==s[s.indexOf(e)+e.length]&&(e+=extract_matching_paren(s,s.indexOf(e)+e.length),s=s.replace(e,"")),a=s.match(/\:\:[a-zA-Z\-]+/g)}for(a=s.match(/\:[a-zA-Z\-]+/g);null!==a&&0<a.length;){var n=a[0];let t=[],e;switch("("==s[s.indexOf(n)+n.length]?(e=extract_matching_paren(s,s.indexOf(n)+n.length),s=s.replace(n+e,""),t=split_selectors(e.substring(1,e.length-1))):s=s.replace(n,""),n){case":where":break;case":is":case":has":case":not":if(0<t.length){let e=t.map(simplified_css_specificity);e.sort(),e.reverse(),l[0]=l[0]+e[0][0],l[1]=l[1]+e[0][1],l[2]=l[2]+e[0][2]}break;case":nth-last-of-type":case":nth-of-type":case":nth-child":case":nth-last-child":t=e.includes(" of ")?[t[0].substring(t[0].indexOf(" of ")+4).trim()]:[];case":host":case":host-context":if(0<t.length){let e=t.map(simplified_css_specificity);e.sort(),e.reverse(),l[0]=l[0]+e[0][0],l[1]=l[1]+e[0][1],l[2]=l[2]+e[0][2]}default:l[1]=l[1]+1}a=s.match(/\:[a-zA-Z\-]+/g)}var i=s.match(/\[[^\]]+\]/g);if(null!==i)for(const p of i)l[1]=l[1]+1,s=s.replace(p,"");i=s.match(/[a-zA-Z\-]\|/g);if(null!==i)for(const x of i)s=s.replace(x,"");for(s=(s=s.replaceAll("*|","")).replaceAll("*","");s.includes(".")||s.includes("#");){var o=s.indexOf("."),h=s.indexOf("#");-1===h||0<=o&&o<h?(o=extract_css_id(s,o+1),s=s.replace("."+o,""),l[1]=l[1]+1):(o=extract_css_id(s,h+1),s=s.replace("#"+o,""),l[0]=l[0]+1)}i=(s=(s=(s=(s=(s=s.replaceAll("+","")).replaceAll(">","")).replaceAll("~","")).replaceAll("&","")).replace(/\s+/g," ").trim()).split(" ");return""!==i[0]&&(l[2]=l[2]+i.length),l}var stack_css_utils={inline:function(){let e=[],s={};for(const r of document.styleSheets)for(const a of r.cssRules){for(const n of split_selectors(a.selectorText))null!==document.querySelector(n)&&(e.push({selectorText:n,style:{cssText:a.style.cssText}}),s[n]=simplified_css_specificity(n));if(0<a.cssRules.length){let t=[];for(const u of a.cssRules)t.push([a.selectorText,u]);for(;0<t.length;){var[f,l]=t.shift(),c=f+l.selectorText;if(null!==document.querySelector(c)&&(e.push({selectorText:c,style:{cssText:l.style.cssText}}),s[c]=simplified_css_specificity(c)),0<l.cssRules.length)for(let e=l.cssRules.length-1;0<=e;e--)t.unshift([c,l.cssRules[e]])}}}e.sort((e,t)=>{e=s[e.selectorText],t=s[t.selectorText];return e<t?-1:t<e?1:0});for(const i of e.reverse()){const o=document.querySelectorAll(i.selectorText);for(let e=0;e<o.length;e++){var t=o[e].getAttribute("style")||"",t=i.style.cssText+";"+t;o[e].setAttribute("style",t)}}}};export default stack_css_utils;export{stack_css_utils};
