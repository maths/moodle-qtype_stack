var that=this;var result={componentInit:function(){if(!this.question){return that.CoreQuestionHelperProvider.showComponentError(that.onAbort)}const div=this.CoreDomUtilsProvider.convertToElement(this.question.html);div.innerHTML=this.question.html;that.CoreQuestionHelperProvider.replaceCorrectnessClasses(div);that.CoreQuestionHelperProvider.replaceFeedbackClasses(div);that.CoreQuestionHelperProvider.treatCorrectnessIcons(div);let questiontext=div.querySelector(".content");const multiAnswers=questiontext.querySelectorAll(".answer");const checkboxAnswers=Array.from(multiAnswers).filter(item=>!item.querySelector('[type="radio"]'));const radioAnswers=Array.from(multiAnswers).filter(item=>item.querySelector('[type="radio"]'));const dropdowns=questiontext.querySelectorAll("select");const dashLink=questiontext.querySelector(".questiontestslink");const validationerror=questiontext.querySelector(".validationerror");const inputs=questiontext.querySelectorAll('input[type="text"]');inputs.forEach(function(input){let width=input.style.width;if(width.endsWith("em")){width=width.replace("em","");width=width*1.3;width=width+"em";input.style.width=width}});if(validationerror){validationerror.setAttribute("hidden",true)}if(dashLink){dashLink.parentNode.removeChild(dashLink)}const prompt=div.querySelector(".prompt");this.question.divId=div.querySelector("div").getAttribute("id");if(typeof questiontext.innerHTML==="undefined"){return that.CoreQuestionHelperProvider.showComponentError(that.onAbort)}if(prompt!==null){this.question.prompt=prompt.innerHTML}checkboxAnswers.forEach(function(checkboxset){const options=checkboxset.querySelectorAll(".option");const optionOutput=[];options.forEach(function(option){const label=option.querySelector("label").innerHTML;const name=option.querySelector("label").getAttribute("for");const checked=option.querySelector("input[type=checkbox]").getAttribute("checked")?true:false;const disabled=option.querySelector("input").getAttribute("disabled")==="disabled"?true:false;const qclass=option.getAttribute("class");const value=option.querySelector("input").getAttribute("value");optionOutput.push({text:label,name:name,checked:checked,disabled:disabled,qclass:qclass,value:value})});let replacement='<ion-item class="answer"><div>';for(let option of optionOutput){replacement+='<div class="flex-column">';replacement+='<ion-checkbox checked="'+option.checked+'" value="'+option.value+'" name="'+option.name+'" disabled="'+option.disabled+'">';replacement+='<div class="'+option.class+'">';replacement+=option.text+"</div>";replacement+="</ion-checkbox></div>"}replacement+="</div></ion-item>";const template=document.createElement("div");template.innerHTML=replacement;let nativeSelectElement=template.querySelector("ion-item");checkboxset.replaceWith(nativeSelectElement)});radioAnswers.forEach(function(radioset){let options=radioset.querySelectorAll(".option");const radioOutput={};options=Array.from(options).filter(item=>item.querySelector('input[type="radio"]'));const optionOutput=[];options.forEach(function(option){const label=option.querySelector("label").innerHTML;const name=option.querySelector("input").getAttribute("name");const disabled=option.querySelector("input").getAttribute("disabled")==="disabled"?true:false;const qclass=option.getAttribute("class");const value=option.querySelector("input").getAttribute("value");if(option.querySelector("input").getAttribute("checked")==="checked"){radioOutput.initialValue=value}optionOutput.push({text:label,name:name,disabled:disabled,qclass:qclass,value:value})});radioOutput.name=optionOutput[0].name;if(!radioOutput.initialValue){radioOutput.initialValue=""}let replacement='<ion-item class="answer"><div class="flex-column"><ion-radio-group name="'+radioOutput.name+'" value="'+radioOutput.initialValue+'">';for(let option of optionOutput){replacement+='<ion-radio justify="start" label-placement="end" value="'+option.value+'" disabled="'+option.disabled+'" name="'+option.name+'">';replacement+='<div class="'+option.class+'">'+option.text+"</div></ion-radio>"}replacement+="</ion-radio-group></div></ion-item>";const template=document.createElement("div");template.innerHTML=replacement;let nativeSelectElement=template.querySelector("ion-item");radioset.replaceWith(nativeSelectElement)});dropdowns.forEach(function(dropdown){const options=dropdown.querySelectorAll("option");const dropdownOutput={};const optionOutput=[];dropdownOutput.id=dropdown.getAttribute("id");dropdownOutput.name=dropdown.getAttribute("name");options.forEach(function(option){const label=option.innerHTML;const disabled=option.getAttribute("disabled")==="disabled"?true:false;const value=option.getAttribute("value");if(option.getAttribute("selected")==="selected"){dropdownOutput.initialValue=value}optionOutput.push({text:label,disabled:disabled,value:value})});dropdownOutput.options=optionOutput;if(!dropdownOutput.initialValue){dropdownOutput.initialValue=""}let replacement='<ion-select class="stack-ion-select" id="'+dropdownOutput.id+'" value="'+dropdownOutput.initialValue+'" name="'+dropdownOutput.name+'">';for(let option of options){replacement+='<ion-select-option value="'+option.value+'" disabled="'+option.disabled+'">';replacement+=option.text+"</ion-select-option>"}replacement+="</ion-select>";const template=document.createElement("div");template.innerHTML=replacement;let nativeSelectElement=template.querySelector("ion-select");dropdown.replaceWith(nativeSelectElement)});this.question.text=questiontext.innerHTML;const scripts=this.question.scriptsCode;let initCalls=scripts.match(/amd\.initInputs\(.*\]\);/g);initCalls=initCalls?initCalls:[];const inputInits=[];for(let currentInit of initCalls){currentInit=currentInit.slice(15,-2);const initArgs=JSON.parse("["+currentInit+"]");inputInits.push(initArgs)}let iframes=scripts.match(/stackjsvle\.create_iframe\(.*;\}\);;/g);iframes=iframes?iframes:[];const iframesArgs=[];let siteUrl=that.CoreSitesProvider.currentSite.siteUrl;for(let iframe of iframes){iframe=iframe.slice(25,-6);if(iframe.endsWith(",")){iframe+="false"}const args=JSON.parse("["+iframe+"]");const baseRef=siteUrl+"/question/type/stack/corsscripts/cors.php?name=";args[1]=args[1].replace(baseRef+'sortable.min.css" rel="stylesheet">',baseRef+'sortable.min.css" rel="stylesheet">'+'<link rel="stylesheet" href="'+baseRef+'styles.css"></link>');args[1]=args[1].replace(/<img/g,"<img crossorigin='anonymous'");args[1]=args[1].replace(/<script/g,"<script crossorigin='anonymous'");args[1]=args[1].replace(/<link/g,"<link crossorigin='anonymous'");iframesArgs.push(args)}setTimeout(()=>{const observer=new MutationObserver(()=>{if(document.querySelector("#"+this.question.divId)){observer.disconnect();for(const args of inputInits){initInputs(...args)}for(const args of iframesArgs){create_iframe(...args)}if(document.querySelector("."+"MathJax_Error")){window.MathJax.Hub.Queue(["Typeset",window.MathJax.Hub])}}});observer.observe(document.body,{childList:true,subtree:true})});function StackInput(validationDiv,prefix,qaid,name,input,language,validationsInProgress){var TYPING_DELAY=1e3;var delayTimeoutHandle=null;var validationResults={};var lastValidatedValue=getInputValue();var checkButton=document.getElementById(prefix+"-submit");function cancelTypingDelay(){if(delayTimeoutHandle){clearTimeout(delayTimeoutHandle)}delayTimeoutHandle=null}input.addEventHandlers(valueChanging);function valueChanging(){cancelTypingDelay();showWaiting();delayTimeoutHandle=setTimeout(valueChanged,TYPING_DELAY);setTimeout(function(){checkNoChange()},0)}function checkNoChange(){if(getInputValue()===lastValidatedValue){cancelTypingDelay();validationDiv.classList.remove("waiting");if(checkButton){validationsInProgress.delete(name);if(validationsInProgress.size===0){checkButton.disabled=false}}}}function valueChanged(){cancelTypingDelay();if(!showValidationResults()){validateInput()}}function validateInput(){const args={qaid:qaid,name:name,input:getInputValue(),lang:language};that.CoreSitesProvider.getCurrentSite().read("qtype_stack_validate_input",args).then(function(response){validationReceived(response)}).catch(function(response){showValidationFailure(response)});showLoading()}function getInputValue(){return input.getValue()}function validationReceived(response){if(response.status==="invalid"){showValidationFailure(response);return}validationResults[response.input]=response;showValidationResults()}function extractScripts(html,scriptCommands){var scriptregexp=/<script[^>]*>([\s\S]*?)<\/script>/g;var result;while((result=scriptregexp.exec(html))!==null){scriptCommands.push(result[1])}return html.replace(scriptregexp,"")}function showValidationResults(){var val=getInputValue();if(!validationResults[val]){showWaiting();return false}var results=validationResults[val];lastValidatedValue=val;var scriptCommands=[];validationDiv.innerHTML=extractScripts(results.message,scriptCommands);for(var i=0;i<scriptCommands.length;i++){eval(scriptCommands[i])}removeAllClasses();if(!results.message){validationDiv.classList.add("empty")}const filters=that.CoreFilterDelegate.getEnabledFilters("system");that.CoreFilterDelegate.handleHtml(validationDiv,filters);return true}function showValidationFailure(response){lastValidatedValue="";validationDiv.innerHTML=response.message;removeAllClasses();validationDiv.classList.add("error");const filters=that.CoreFilterDelegate.getEnabledFilters("system");that.CoreFilterDelegate.handleHtml(validationDiv,filters)}function showLoading(){removeAllClasses();validationDiv.classList.add("loading")}function showWaiting(){removeAllClasses();validationDiv.classList.add("waiting");if(checkButton){validationsInProgress.add(name);checkButton.disabled=true}}function removeAllClasses(){validationDiv.classList.remove("empty");validationDiv.classList.remove("error");validationDiv.classList.remove("loading");validationDiv.classList.remove("waiting");if(checkButton){validationsInProgress.delete(name);if(validationsInProgress.size===0){checkButton.disabled=false}}}}function StackSimpleInput(input){this.addEventHandlers=function(valueChanging){input.addEventListener("input",valueChanging)};this.getValue=function(){return input.value.replace(/^\s+|\s+$/g,"")}}function StackSelectInput(input){this.addEventHandlers=function(valueChanging){input.addEventListener("ionChange",valueChanging)};this.getValue=function(){return input.value.replace(/^\s+|\s+$/g,"")}}function StackTextareaInput(textarea){this.addEventHandlers=function(valueChanging){textarea.addEventListener("input",valueChanging)};this.getValue=function(){var raw=textarea.value.replace(/^\s+|\s+$/g,"");return raw.split(/\s*[\r\n]\s*/).join("<br>")}}function StackRadioInput(questionDivId,prefix,name){this.addEventHandlers=function(valueChanging){const inputs=document.querySelectorAll("#"+questionDivId+' ion-radio-group[name^="'+prefix+name+'"]');for(const input of inputs){input.addEventListener("ionChange",valueChanging)}};this.getValue=function(){var selected=document.querySelector("#"+questionDivId+' ion-radio-group[name^="'+prefix+name+'"]');return selected.value}}function StackCheckboxInput(questionDivId,prefix,name){this.addEventHandlers=function(valueChanging){const inputs=document.querySelectorAll("#"+questionDivId+' [name^="'+prefix+name+'_"]');for(const input of inputs){input.addEventListener("click",valueChanging)}};this.getValue=function(){var selected=document.querySelectorAll("#"+questionDivId+' ion-checkbox[name^="'+prefix+name+'_"]');var result=[];for(var i=0;i<selected.length;i++){if(selected[i].checked){result.push(selected[i].value)}}if(result.length>0){return result.join(",")}else{return""}}}function StackMatrixInput(idPrefix,container){var numcol=0;var numrow=0;container.querySelectorAll("input[type=text]").forEach(function(element){if(element.name.slice(0,idPrefix.length+5)!==idPrefix+"_sub_"){return}var bits=element.name.substring(idPrefix.length+5).split("_");numrow=Math.max(numrow,parseInt(bits[0],10)+1);numcol=Math.max(numcol,parseInt(bits[1],10)+1)});this.addEventHandlers=function(valueChanging){container.addEventListener("input",valueChanging)};this.getValue=function(){var values=new Array(numrow);for(var i=0;i<numrow;i++){values[i]=new Array(numcol)}container.querySelectorAll("input[type=text]").forEach(function(element){if(element.name.slice(0,idPrefix.length+5)!==idPrefix+"_sub_"){return}var bits=element.name.substring(idPrefix.length+5).split("_");values[bits[0]][bits[1]]=element.value.replace(/^\s+|\s+$/g,"")});return JSON.stringify(values)}}function initInputs(questionDivId,prefix,qaid,inputs){var questionDiv=document.getElementById(questionDivId);var validationsInProgress=new Set;var language=null;var langInput=document.getElementsByName(prefix+"step_lang");if(langInput.length>0&&langInput[0].value){language=langInput[0].value}var allok=true;for(var i=0;i<inputs.length;i++){allok=initInput(questionDivId,prefix,qaid,inputs[i],language,validationsInProgress)&&allok}if(allok&&(questionDiv.classList.contains("dfexplicitvaildate")||questionDiv.classList.contains("dfcbmexplicitvaildate"))){const input=questionDiv.querySelector(".im-controls input.submit, .im-controls button.submit");if(input){input.hidden=true}}}function initInput(questionDivId,prefix,qaid,name,language,validationsInProgress){var validationDiv=document.getElementById(prefix+name+"_val");if(!validationDiv){return false}var inputTypeHandler=getInputTypeHandler(questionDivId,prefix,name);if(inputTypeHandler){new StackInput(validationDiv,prefix,qaid,name,inputTypeHandler,language,validationsInProgress);return true}else{return false}}function getInputTypeHandler(questionDivId,prefix,name){var input=document.querySelector("#"+questionDivId+' [name="'+prefix+name+'"]');if(input){if(input.nodeName==="TEXTAREA"){return new StackTextareaInput(input)}else if(input.tagName==="ION-RADIO-GROUP"){return new StackRadioInput(questionDivId,prefix,name)}else if(input.tagName==="ION-SELECT"){return new StackSelectInput(input)}else{return new StackSimpleInput(input)}}input=document.querySelector("#"+questionDivId+' [name="'+prefix+name+'_1"]');if(input){return new StackCheckboxInput(questionDivId,prefix,name)}var matrix=document.getElementById(prefix+name+"_container");if(matrix){return new StackMatrixInput(prefix+name,matrix)}return null}let IFRAMES={};let INPUTS={};let INPUTS_INPUT_EVENT={};let DISABLE_CHANGES=false;const abortController=new AbortController;function vle_get_element(id){let candidate=document.getElementById(id);let iter=candidate;while(iter&&!iter.classList.contains("formulation")&&!iter.classList.contains("outcome")){iter=iter.parentElement}if(iter&&(iter.classList.contains("formulation")||iter.classList.contains("outcome"))){return candidate}return null}function vle_get_input_element(name,srciframe,outside){if(outside===undefined){outside=true}let initialcandidate=document.getElementById(srciframe);let iter=initialcandidate;while(iter&&!iter.classList.contains("formulation")&&!iter.classList.contains("outcome")){iter=iter.parentElement}if(iter&&(iter.classList.contains("formulation")||iter.classList.contains("outcome"))){let possible=iter.querySelector('input[id$="_'+name+'"]');if(possible!==null){return possible}possible=iter.querySelector('textarea[id$="_'+name+'"]');if(possible!==null){return possible}possible=iter.querySelector('ion-radio-group[name$="_'+name+'"]');if(possible!==null){return possible}possible=iter.querySelector('ion-checkbox[name$="_'+name+'_1"]');if(possible!==null){return possible}possible=iter.querySelector('ion-select[name$="_'+name+'"]');if(possible!==null){return possible}}if(!outside){return null}let possible=document.querySelector('.formulation input[id$="_'+name+'"]');if(possible!==null){return possible}possible=document.querySelector('.formulation textarea[id$="_'+name+'"]');if(possible!==null){return possible}possible=document.querySelector('.formulation ion-radio-group[name$="_'+name+'"]');if(possible!==null){return possible}possible=document.querySelector('.formulation ion-checkbox[name$="_'+name+'_1"]');if(possible!==null){return possible}possible=document.querySelector('.formulation ion-select[name$="_'+name+'"]');if(possible!==null){return possible}possible=document.querySelector('.outcome input[id$="_'+name+'"]');if(possible!==null){return possible}possible=document.querySelector('.outcome textarea[id$="_'+name+'"]');if(possible!==null){return possible}possible=document.querySelector('.outcome ion-select[name$="_'+name+'"]');return possible}function vle_get_others_of_same_input_group(input){if(input.type==="radio"){return document.querySelectorAll(".formulation input[name="+CSS.escape(input.name)+"]")}if(input.name.startsWith("q")&&input.name.indexOf(":")>-1&&input.name.endsWith("_1")){return document.querySelectorAll(".formulation input[name^="+CSS.escape(input.name.substring(0,input.name.length-1))+"]")}return document.querySelectorAll(".formulation input[name="+CSS.escape(input.name)+"]")}function vle_get_submit_button(srciframe){let initialcandidate=document.getElementById(srciframe);let iter=initialcandidate;while(iter&&!iter.classList.contains("formulation")){iter=iter.parentElement}if(iter&&iter.classList.contains("formulation")){let possible=iter.querySelector('.im-controls *[id$="-submit"][type=submit]');return possible}return null}function vle_update_input(inputelement){const c=new Event("change");inputelement.dispatchEvent(c);const i=new Event("input");inputelement.dispatchEvent(i);if(inputelement.type==="radio"||inputelement.type==="checkbox"){const k=new Event("click");inputelement.dispatchEvent(k)}}function vle_update_dom(modifiedsubtreerootelement){CustomEvents.notifyFilterContentUpdated(modifiedsubtreerootelement)}function vle_html_sanitize(src){let parser=new DOMParser;let doc=parser.parseFromString(src,"text/html");for(let el of doc.querySelectorAll("script, style")){el.remove()}for(let el of doc.querySelectorAll("*")){for(let{name,value}of el.attributes){if(is_evil_attribute(name,value)){el.removeAttribute(name)}}}return doc.body}function is_evil_attribute(name,value){const lcname=name.toLowerCase();if(lcname.startsWith("on")){return true}if(lcname==="src"||lcname.endsWith("href")){const lcvalue=value.replace(/\s+/g,"").toLowerCase();if(lcvalue.includes("javascript:")||lcvalue.includes("data:text")){return true}}return false}window.addEventListener("message",eventCallback,{signal:abortController.signal});function eventCallback(e){if(!(typeof e.data==="string"||e.data instanceof String)){return}let msg=null;try{msg=JSON.parse(e.data)}catch(e){return}if(!IFRAMES[msg.src]||!IFRAMES[msg.src].contentWindow){abortController.abort();return}if(!("version"in msg&&msg.version.startsWith("STACK-JS"))){return}if(!("src"in msg&&"type"in msg&&msg.src in IFRAMES)){return}let element=null;let input=null;let response={version:"STACK-JS:1.3.0"};switch(msg.type){case"register-input-listener":input=vle_get_input_element(msg.name,msg.src,!msg["limit-to-question"]);if(input===null){response.type="error";response.msg='Failed to connect to input: "'+msg.name+'"';response.tgt=msg.src;IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(response),"*");return}response.type="initial-input";response.name=msg.name;response.tgt=msg.src;if(input.tagName.toLowerCase()==="ion-select"){response.value=input.value;response["input-type"]="select";response["input-readonly"]=input.hasAttribute("disabled")}else if(input.nodeName.toLowerCase()==="textarea"){response.value=input.value;response["input-type"]="textarea";response["input-readonly"]=input.hasAttribute("disabled")}else if(input.tagName.toLowerCase()==="ion-checkbox"){response.value=input.checked;response["input-type"]="checkbox";response["input-readonly"]=input.hasAttribute("disabled")}else{response.value=input.value;response["input-type"]=input.type;response["input-readonly"]=input.hasAttribute("readonly")}if(input.tagName.toLowerCase()==="ion-radio-group"){response["input-readonly"]=input.hasAttribute("disabled");response.value=input.value}if(input.id in INPUTS){if(msg.src in INPUTS[input.id]){return}INPUTS[input.id].push(msg.src)}else{INPUTS[input.id]=[msg.src];input.addEventListener("change",()=>{if(DISABLE_CHANGES){return}let resp={version:"STACK-JS:1.0.0",type:"changed-input",name:msg.name};if(input.tagName.toLowerCase()==="ion-checkbox"){resp["value"]=input.checked}else{resp["value"]=input.value}for(let tgt of INPUTS[input.id]){resp["tgt"]=tgt;IFRAMES[tgt].contentWindow.postMessage(JSON.stringify(resp),"*")}})}if("track-input"in msg&&msg["track-input"]){if(input.id in INPUTS_INPUT_EVENT){if(msg.src in INPUTS_INPUT_EVENT[input.id]){return}INPUTS_INPUT_EVENT[input.id].push(msg.src)}else{INPUTS_INPUT_EVENT[input.id]=[msg.src];input.addEventListener("input",()=>{if(DISABLE_CHANGES){return}let resp={version:"STACK-JS:1.0.0",type:"changed-input",name:msg.name};if(input.tagName.toLowerCase()==="ion-checkbox"){resp["value"]=input.checked}else{resp["value"]=input.value}for(let tgt of INPUTS_INPUT_EVENT[input.id]){resp["tgt"]=tgt;IFRAMES[tgt].contentWindow.postMessage(JSON.stringify(resp),"*")}})}}if(!(msg.src in INPUTS[input.id])){IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(response),"*")}break;case"changed-input":input=vle_get_input_element(msg.name,msg.src);if(input===null){const ret={version:"STACK-JS:1.0.0",type:"error",msg:'Failed to modify input: "'+msg.name+'"',tgt:msg.src};IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(ret),"*");return}DISABLE_CHANGES=true;if(input.tagName.toLowerCase()==="ion-checkbox"){input.checked=msg.value}else{input.value=msg.value}vle_update_input(input);DISABLE_CHANGES=false;response.type="changed-input";response.name=msg.name;response.value=msg.value;for(let tgt of INPUTS[input.id]){if(tgt!==msg.src){response.tgt=tgt;IFRAMES[tgt].contentWindow.postMessage(JSON.stringify(response),"*")}}break;case"clear-input":input=vle_get_input_element(msg.name,msg.src);if(input.tagName.toLowerCase()==="ion-checkbox"){for(let inp of vle_get_others_of_same_input_group(input)){inp.checked=false;vle_update_input(inp)}}else if(input.type==="radio"){for(let inp of vle_get_others_of_same_input_group(input)){inp.checked=inp.value==="";vle_update_input(inp)}}else{if(input.value!==""){input.value="";vle_update_input(input)}}vle_update_input(input);break;case"register-button-listener":element=vle_get_element(msg.target);if(element===null){const ret={version:"STACK-JS:1.2.0",type:"error",msg:'Failed to find element: "'+msg.target+'"',tgt:msg.src};IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(ret),"*");return}element.addEventListener("click",event=>{let resp={version:"STACK-JS:1.2.0",type:"button-click",name:msg.target,tgt:msg.src};IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(resp),"*");event.preventDefault()});break;case"toggle-visibility":element=vle_get_element(msg.target);if(element===null){const ret={version:"STACK-JS:1.0.0",type:"error",msg:'Failed to find element: "'+msg.target+'"',tgt:msg.src};IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(ret),"*");return}if(msg.set==="show"){element.style.display="block";vle_update_dom(element)}else if(msg.set==="hide"){element.style.display="none"}break;case"change-content":element=vle_get_element(msg.target);if(element===null){response.type="error";response.msg='Failed to find element: "'+msg.target+'"';response.tgt=msg.src;IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(response),"*");return}element.innerHTML=vle_html_sanitize(msg.content).innerHTML;vle_update_dom(element);break;case"get-content":element=vle_get_element(msg.target);response.type="xfer-content";response.tgt=msg.src;response.target=msg.target;response.content=null;if(element!==null){response.content=element.innerHTML}IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(response),"*");break;case"resize-frame":element=IFRAMES[msg.src].parentElement;element.style.width=msg.width;element.style.height=msg.height;IFRAMES[msg.src].style.width="100%";IFRAMES[msg.src].style.height="100%";vle_update_dom(element);break;case"ping":response.type="ping";response.tgt=msg.src;IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(response),"*");return;case"query-submit-button":response.type="submit-button-info";response.tgt=msg.src;input=vle_get_submit_button(msg.src);if(input===null||input.hasAttribute("hidden")){response["value"]=null}else{response["value"]=input.value}IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(response),"*");return;case"enable-submit-button":input=vle_get_submit_button(msg.src);if(input!==null){if(msg.enabled){input.removeAttribute("disabled")}else{input.disabled=true}}else{response.type="error";response.msg="Could not find matching submit button for this question.";response.tgt=msg.src;IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(response),"*")}return;case"relabel-submit-button":input=vle_get_submit_button(msg.src);if(input!==null){if(input.childNodes.length>1){input.childNodes.forEach(n=>{if(n.nodeName=="#text"){n.textContent=msg.name}})}else{input.innerHTML=msg.name}input.value=msg.name}else{response.type="error";response.msg="Could not find matching submit button for this question.";response.tgt=msg.src;IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(response),"*")}return;case"submit-button-info":case"initial-input":case"error":break;default:response.type="error";response.msg='Unknown message-type: "'+msg.type+'"';response.tgt=msg.src;IFRAMES[msg.src].contentWindow.postMessage(JSON.stringify(response),"*")}}function create_iframe(iframeid,content,targetdivid,title,scrolling,evil){const frm=document.createElement("iframe");frm.id=iframeid;frm.style.width="100%";frm.style.height="100%";frm.style.border=0;if(scrolling===false){frm.scrolling="no";frm.style.overflow="hidden"}else{frm.scrolling="yes"}frm.title=title;frm.referrerpolicy="no-referrer";if(!evil){frm.sandbox="allow-scripts allow-downloads"}frm.srcdoc=content;document.getElementById(targetdivid).replaceChildren(frm);IFRAMES[iframeid]=frm}return true}};result;
